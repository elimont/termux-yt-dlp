#!/usr/bin/env bash

BLUE='\e[34m'
NC='\e[0m'
YTDLP_CONFIG_FOLDER="${HOME}/.config/yt-dlp/"
TERMUXURLOPENER_CONFIG_FOLDER="${HOME}/bin/"

echo "Hi, This script sets up an environment to download various videos from various apps."
sleep 1

# Check if required packages are installed
if ! command -v python >/dev/null 2>&1; then
    echo "Python is not installed. Installing python..."
    yes '' | pkg install python
fi

if ! command -v ffmpeg >/dev/null 2>&1; then
    echo "FFmpeg is not installed. Installing ffmpeg..."
    yes '' | pkg install ffmpeg
fi

# Check if storage permission is granted
if [ ! -d "$HOME/storage" ]; then
    echo -e "${BLUE}Please grant storage access to Termux by going to Settings > Apps > Termux > Permissions > Storage.${NC}"
    exit 1
fi

echo -e "\n\n${BLUE}Requirements:${NC}"
echo "    1. Allow storage access to Termux."
echo "    2. A working internet connection."
read -p "When you are ready just press enter:"

# Basic setup
termux-setup-storage
sleep 5
pkg update
pip install pip
pip install wheel
pip install yt-dlp
mkdir -p $TERMUXURLOPENER_CONFIG_FOLDER
ln -sf $YTDLP_CONFIG_FOLDER/termux-url-opener $TERMUXURLOPENER_CONFIG_FOLDER/termux-url-opener

echo -e "${BLUE}Congratulations!!! Your setup is complete.${NC}\n\n"
